<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ukraine Coin</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap');
    body {
      margin: 0; padding: 0;
      background-color: #000;
      color: #ffd500;
      font-family: 'Montserrat', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      user-select: none;
    }
    header {
      text-align: center;
      padding: 20px 0 10px 0;
      font-size: 36px;
      font-weight: 700;
      letter-spacing: 4px;
      user-select: none;
    }
    header .coin {
      color: #00bfff;
      text-shadow: 0 0 8px #00bfff88;
    }
    main {
      flex: 1;
      padding: 10px 20px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    footer {
      display: flex;
      background: #111;
      border-top: 1px solid #222;
    }
    footer button {
      flex: 1;
      background: transparent;
      border: none;
      color: #ffd500;
      font-weight: 700;
      padding: 12px 0;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s;
    }
    footer button.active,
    footer button:hover {
      background: #222;
    }
    .hidden {
      display: none;
    }

    /* TAP */
    #tap-tab {
      text-align: center;
    }
    #coin-button {
      margin: 20px auto;
      width: 160px;
      height: 160px;
      background-color: #ffd500;
      border-radius: 50%;
      border: 6px solid #f9f871;
      box-shadow: 0 0 20px #ffd500aa inset, 0 0 15px #ffd500;
      cursor: pointer;
      background-size: cover;
      transition: transform 0.1s ease;
    }
    #coin-button:active {
      transform: scale(0.9);
    }
    #score-display, #energy-display {
      font-size: 22px;
      margin: 10px 0 0 0;
      user-select: none;
    }

    /* SKINS */
    #skins-tab {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
    }
    .skin-thumb {
      width: 100px;
      height: 100px;
      border-radius: 16px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border: 3px solid transparent;
      cursor: pointer;
      position: relative;
      box-shadow: 0 0 8px #222 inset;
      transition: border-color 0.3s;
    }
    .skin-thumb.selected {
      border-color: #00bfff;
      box-shadow: 0 0 10px #00bfff;
    }
    .skin-thumb::after {
      content: attr(data-cost);
      position: absolute;
      bottom: 4px;
      right: 6px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 8px;
      user-select: none;
    }

    /* QUESTS */
    .quest {
      background: #111;
      padding: 15px 20px;
      margin-bottom: 15px;
      border-radius: 12px;
      box-shadow: 0 0 10px #222 inset;
    }
    .quest h3 {
      margin: 0 0 6px 0;
      color: #00bfff;
    }
    .quest p {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #ccc;
    }
    .quest button {
      background-color: #00bfff;
      border: none;
      color: #fff;
      font-weight: 700;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .quest button.completed {
      background-color: #444;
      cursor: default;
    }
    .quest button:hover:not(.completed) {
      background-color: #0080ff;
    }

    /* UPGRADES */
    #upgrades-tab .upgrade {
      background: #111;
      border-radius: 12px;
      margin-bottom: 16px;
      padding: 15px 20px;
      box-shadow: 0 0 10px #222 inset;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #ccc;
    }
    #upgrades-tab .upgrade-info h4 {
      margin: 0 0 4px 0;
      color: #00bfff;
    }
    #upgrades-tab .upgrade-info p {
      margin: 0;
      font-size: 14px;
    }
    #upgrades-tab button {
      background-color: #00bfff;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s;
      min-width: 130px;
    }
    #upgrades-tab button:disabled {
      background-color: #444;
      cursor: default;
    }
    #upgrades-tab button:hover:enabled {
      background-color: #0080ff;
    }

    /* DONATE */
    #donate-section {
      text-align: center;
      padding: 20px;
    }
    #donate-section a {
      display: inline-block;
      background: #ffd500;
      color: #000;
      font-weight: 700;
      padding: 14px 24px;
      border-radius: 20px;
      text-decoration: none;
      box-shadow: 0 0 12px #ffd50088;
      user-select: none;
      transition: background-color 0.3s;
    }
    #donate-section a:hover {
      background-color: #e5c500;
    }
  </style>
</head>
<body>
  <header>
    Ukraine <span class="coin">Coin</span>
  </header>

  <main>
    <!-- TAP -->
    <section id="tap-tab">
      <div id="coin-button" title="Нажми!"></div>
      <div id="score-display">Монеты: 0</div>
      <div id="energy-display">Энергия: 100 / 100</div>
    </section>

    <!-- SKINS -->
    <section id="skins-tab" class="hidden"></section>

    <!-- QUESTS -->
    <section id="quests-tab" class="hidden"></section>

    <!-- UPGRADES -->
    <section id="upgrades-tab" class="hidden"></section>

    <!-- DONATE -->
    <section id="donate-section" class="hidden">
      <a href="https://savelife.in.ua/donate/" target="_blank" rel="noopener noreferrer" title="Помочь ЗСУ">Поддержать ЗСУ</a>
    </section>
  </main>

  <footer>
    <button class="tab-btn active" data-tab="tap-tab">Тап</button>
    <button class="tab-btn" data-tab="skins-tab">Магазин скинов</button>
    <button class="tab-btn" data-tab="quests-tab">Задания</button>
    <button class="tab-btn" data-tab="upgrades-tab">Прокачка</button>
    <button class="tab-btn" data-tab="donate-section">Донат</button>
  </footer>

<script>
  const WebApp = window.Telegram?.WebApp || null;
  if (WebApp) WebApp.ready();

  let user = WebApp?.initDataUnsafe?.user || { id: 'user' + Math.floor(Math.random() * 10000), first_name: 'Игрок' };
  const STORAGE_KEY = 'ukraine_coin_data';

  const defaultData = {
    score: 0,
    energy: 100,
    energyMax: 100,
    clickPower: 1,
    upgradesBought: {
      click: 0,
      energy: 0
    },
    questsDone: [],
    skinIndex: 0,
  };

  function loadData() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) return JSON.parse(saved);
    } catch(e){}
    return {...defaultData};
  }

  function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  let data = loadData();

  const scoreDisplay = document.getElementById('score-display');
  const energyDisplay = document.getElementById('energy-display');
  const coinButton = document.getElementById('coin-button');
  const skinsTab = document.getElementById('skins-tab');
  const questsTab = document.getElementById('quests-tab');
  const upgradesTab = document.getElementById('upgrades-tab');
  const donateSection = document.getElementById('donate-section');

  const coinSkins = [
    { name: 'Классическая', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Golden_coin_icon.svg/120px-Golden_coin_icon.svg.png', cost: 0 },
    { name: 'Сияющая', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Gold_coin_icon.svg/120px-Gold_coin_icon.svg.png', cost: 5000 },
    { name: 'Электро', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Bitcoin.svg/120px-Bitcoin.svg.png', cost: 15000 },
    { name: 'Пламя', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Fire_icon.svg/120px-Fire_icon.svg.png', cost: 30000 }
  ];

  function renderSkins() {
    skinsTab.innerHTML = '';
    coinSkins.forEach((skin, idx) => {
      const div = document.createElement('div');
      div.className = 'skin-thumb';
      div.style.backgroundImage = `url(${skin.url})`;
      div.dataset.cost = skin.cost > 0 ? skin.cost + ' монет' : 'Бесплатно';
      if (data.skinIndex === idx) div.classList.add('selected');
      div.title = `${skin.name} (${div.dataset.cost})`;
      div.onclick = () => {
        if (idx === data.skinIndex) return;
        if (data.score >= skin.cost) {
          data.skinIndex = idx;
          updateScore(-skin.cost);
          saveData();
          updateUI();
          renderSkins();
          alert(`Вы купили и выбрали скин "${skin.name}"`);
        } else {
          alert(`Недостаточно монет для покупки скина "${skin.name}"`);
        }
      };
      skinsTab.appendChild(div);
    });
  }

  const quests = [
    {
      id: 'sub_telegram',
      title: 'Подпишись на наш Telegram канал',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на Telegram канал'),
    },
    {
      id: 'sub_tiktok',
      title: 'Подпишись на TikTok',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на TikTok'),
    },
    {
      id: 'sub_youtube',
      title: 'Подпишись на YouTube',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на YouTube'),
    },
  ];

  function renderQuests() {
    questsTab.innerHTML = '';
    quests.forEach(q => {
      const done = data.questsDone.includes(q.id);
      const div = document.createElement('div');
      div.className = 'quest';

      const h3 = document.createElement('h3');
      h3.textContent = q.title;

      const p = document.createElement('p');
      p.textContent = q.desc;

      const btn = document.createElement('button');
      btn.textContent = done ? 'Выполнено' : 'Выполнить';
      btn.disabled = done;
      btn.className = done ? 'completed' : '';

      btn.onclick = () => {
        if (q.check()) {
          data.questsDone.push(q.id);
          updateScore(q.reward);
          saveData();
          renderQuests();
          updateUI();
          alert(`Вы получили ${q.reward} монет!`);
        }
      };

      div.appendChild(h3);
      div.appendChild(p);
      div.appendChild(btn);

      questsTab.appendChild(div);
    });
  }

  // Улучшения
  const upgradesList = [
    {
      id: 'click',
      title: 'Улучшить клик',
      desc: 'Увеличивает количество монет за клик',
      baseCost: 100,
      baseAmount: 1,
      getCost() {
        return Math.floor(this.baseCost * Math.pow(1.5, data.upgradesBought.click));
      },
      buy() {
        data.clickPower += this.baseAmount;
        data.upgradesBought.click++;
      },
      getDesc() {
        return `+${this.baseAmount} монет за клик`;
      }
    },
    {
      id: 'energy',
      title: 'Улучшить энергию',
      desc: 'Увеличивает максимум энергии и текущую энергию',
      baseCost: 150,
      baseAmount: 10,
      getCost() {
        return Math.floor(this.baseCost * Math.pow(1.5, data.upgradesBought.energy));
      },
      buy() {
        data.energyMax += this.baseAmount;
        data.energy += this.baseAmount;
        data.upgradesBought.energy++;
        if (data.energy > data.energyMax) data.energy = data.energyMax;
      },
      getDesc() {
        return `+${this.baseAmount} максимума энергии`;
      }
    }
  ];

  function renderUpgrades() {
    upgradesTab.innerHTML = '';
    upgradesList.forEach(upg => {
      const cost = upg.getCost();
      const div = document.createElement('div');
      div.className = 'upgrade';

      const info = document.createElement('div');
      info.className = 'upgrade-info';

      const title = document.createElement('h4');
      title.textContent = `${upg.title} (уровень: ${data.upgradesBought[upg.id]})`;

      const desc = document.createElement('p');
      desc.textContent = upg.desc + ' — ' + upg.getDesc();

      info.appendChild(title);
      info.appendChild(desc);

      const btn = document.createElement('button');
      btn.textContent = `Купить за ${cost} монет`;
      btn.disabled = data.score < cost;
      btn.onclick = () => {
        if (data.score >= cost) {
          updateScore(-cost);
          upg.buy();
          saveData();
          renderUpgrades();
          updateUI();
        }
      };

      div.appendChild(info);
      div.appendChild(btn);

      upgradesTab.appendChild(div);
    });
  }

  function updateScore(amount) {
    data.score += amount;
    if (data.score < 0) data.score = 0;
  }

  function updateUI() {
    scoreDisplay.textContent = `Монеты: ${data.score}`;
    energyDisplay.textContent = `Энергия: ${Math.floor(data.energy)} / ${data.energyMax}`;
    coinButton.style.backgroundImage = `url(${coinSkins[data.skinIndex].url})`;
    renderSkins(); // обновить выделение скина
    renderUpgrades(); // обновить доступность кнопок
  }

  coinButton.onclick = () => {
    if (data.energy >= 1) {
      data.energy -= 1;
      updateScore(data.clickPower);
      saveData();
      updateUI();
    } else {
      alert('Не хватает энергии! Улучшайте энергию в прокачке.');
    }
  };

  // Восполнение энергии +1 каждую секунду
  setInterval(() => {
    if (data.energy < data.energyMax) {
      data.energy += 1;
      if (data.energy > data.energyMax) data.energy = data.energyMax;
      saveData();
      updateUI();
    }
  }, 1000);

  // Переключение вкладок
  const tabButtons = document.querySelectorAll('footer button.tab-btn');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const tabId = btn.dataset.tab;
      ['tap-tab', 'skins-tab', 'quests-tab', 'upgrades-tab', 'donate-section'].forEach(id => {
        document.getElementById(id).classList.toggle('hidden', id !== tabId);
      });

      if (tabId === 'quests-tab') renderQuests();
      if (tabId === 'upgrades-tab') renderUpgrades();
      if (tabId === 'skins-tab') renderSkins();
    });
  });

  // Инициализация UI при загрузке
  updateUI();
  renderQuests();
</script>

</body>
</html>
