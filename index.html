<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ukraine Coin</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

  body {
    margin: 0;
    font-family: 'Montserrat', sans-serif;
    background: #000;
    color: #fff;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    text-align: center;
    padding: 15px 10px 10px;
    font-weight: 700;
    font-size: 28px;
    letter-spacing: 1.2px;
    user-select: none;
    color: #ffdd33;
    text-shadow: 0 0 10px #ffdd33;
  }
  header .coin {
    color: #4fc3f7; /* голубой */
    text-shadow: 0 0 15px #4fc3f7;
  }
  main {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px 15px;
  }
  footer {
    display: flex;
    justify-content: space-around;
    background: #111;
    padding: 8px 0;
    user-select: none;
    border-top: 1px solid #333;
  }
  footer button {
    background: none;
    border: none;
    color: #aaa;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 8px;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  footer button.active, footer button:hover {
    background-color: #ffdd33;
    color: #000;
  }
  .hidden {
    display: none;
  }
  /* --- TAP TAB --- */
  #tap-tab {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #coin-button {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    border: 5px solid #ffdd33;
    background: radial-gradient(circle at center, #ffd833 40%, #b28800 90%);
    box-shadow: 0 0 25px #ffdd33;
    cursor: pointer;
    margin: 25px 0;
    position: relative;
    transition: transform 0.1s ease;
    user-select: none;
  }
  #coin-button:active {
    transform: scale(0.9);
  }
  #coin-button img {
    width: 90px;
    position: absolute;
    top: 25px;
    left: 50%;
    transform: translateX(-50%);
    user-select: none;
    pointer-events: none;
  }
  #score-display {
    font-size: 36px;
    font-weight: 700;
    text-shadow: 0 0 15px #ffdd33;
    margin-bottom: 6px;
  }
  #energy-display {
    font-size: 18px;
    margin-top: 10px;
    color: #ffcc00;
    text-shadow: 0 0 6px #ffcc00;
  }
  /* --- QUESTS TAB --- */
  #quests-tab {
    max-width: 600px;
    margin: 0 auto;
  }
  .quest {
    background: rgba(255, 221, 51, 0.1);
    border-radius: 12px;
    margin-bottom: 15px;
    padding: 15px 20px;
    box-shadow: 0 0 12px #b28800;
  }
  .quest h3 {
    margin: 0 0 8px 0;
    font-weight: 700;
    color: #fff;
  }
  .quest p {
    margin: 6px 0 12px 0;
    font-size: 14px;
    color: #ffdd33cc;
  }
  .quest button {
    background: #ffdd33;
    border: none;
    color: #000;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .quest button.completed {
    background: #33cc33;
    cursor: default;
    color: #000;
  }
  .quest button:disabled {
    opacity: 0.7;
    cursor: default;
  }
  /* --- TOP TAB --- */
  #top-tab {
    max-width: 600px;
    margin: 0 auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    color: #ffdd33cc;
    font-weight: 600;
  }
  th, td {
    padding: 10px 8px;
    border-bottom: 1px solid #333;
    text-align: left;
  }
  th {
    background: #b28800;
    color: #000;
  }
  /* --- UPGRADES TAB --- */
  #upgrades-tab {
    max-width: 600px;
    margin: 0 auto;
  }
  .upgrade {
    background: rgba(255, 221, 51, 0.1);
    border-radius: 12px;
    margin-bottom: 15px;
    padding: 15px 20px;
    box-shadow: 0 0 12px #b28800;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .upgrade-info {
    max-width: 70%;
  }
  .upgrade-info h4 {
    margin: 0 0 8px 0;
    font-weight: 700;
    color: #fff;
  }
  .upgrade-info p {
    margin: 0;
    font-size: 14px;
    color: #ffdd33cc;
  }
  .upgrade button {
    background: #ffdd33;
    border: none;
    color: #000;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .upgrade button:disabled {
    opacity: 0.6;
    cursor: default;
  }
  /* --- DONATE BUTTON --- */
  #donate-section {
    text-align: center;
    margin-top: 20px;
  }
  #donate-section a {
    display: inline-block;
    background: #00cc44;
    color: white;
    font-weight: 700;
    padding: 14px 30px;
    border-radius: 30px;
    text-decoration: none;
    font-size: 18px;
    box-shadow: 0 0 15px #00cc44;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #donate-section a:hover {
    background: #009933;
  }
  /* --- SKINS --- */
  #skin-selector {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .skin-thumb {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 3px solid transparent;
    cursor: pointer;
    transition: border-color 0.3s ease;
    box-shadow: 0 0 8px #b28800;
    background-size: cover;
    background-position: center;
  }
  .skin-thumb.selected {
    border-color: #ffdd33;
    box-shadow: 0 0 15px #ffdd33;
  }
</style>
</head>
<body>
<header><span>Ukraine </span><span class="coin">Coin</span></header>

<main>
  <!-- TAP TAB -->
  <section id="tap-tab">
    <div id="score-display">Монеты: 0</div>
    <button id="coin-button" title="Нажми на монету!">
      <img id="coin-image" src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Golden_coin_icon.svg/120px-Golden_coin_icon.svg.png" alt="Монета" />
    </button>
    <div id="energy-display">Энергия: 100 / 100</div>
    <div id="skin-selector" title="Выбери скин для монеты"></div>
  </section>

  <!-- QUESTS TAB -->
  <section id="quests-tab" class="hidden"></section>

  <!-- TOP TAB -->
  <section id="top-tab" class="hidden">
    <table>
      <thead><tr><th>Игрок</th><th>Монеты</th></tr></thead>
      <tbody id="top-list"></tbody>
    </table>
  </section>

  <!-- UPGRADES TAB -->
  <section id="upgrades-tab" class="hidden"></section>

  <!-- DONATE TAB -->
  <section id="donate-section" class="hidden">
    <a href="https://savelife.in.ua/donate/" target="_blank" rel="noopener noreferrer" title="Помочь ЗСУ">Поддержать ЗСУ</a>
  </section>
</main>

<footer>
  <button class="tab-btn active" data-tab="tap-tab">Тап</button>
  <button class="tab-btn" data-tab="quests-tab">Задания</button>
  <button class="tab-btn" data-tab="top-tab">Топ</button>
  <button class="tab-btn" data-tab="upgrades-tab">Прокачка</button>
  <button class="tab-btn" data-tab="donate-section">Донат</button>
</footer>

<script>
  const WebApp = window.Telegram?.WebApp || null;
  if (WebApp) WebApp.ready();

  let user = WebApp?.initDataUnsafe?.user || { id: 'user' + Math.floor(Math.random() * 10000), first_name: 'Игрок' };
  const STORAGE_KEY = 'ukraine_coin_data';

  const defaultData = {
    score: 0,
    energy: 100,
    energyMax: 100,
    clickPower: 1,
    upgradesBought: {
      click: 0,
      energy: 0
    },
    questsDone: [],
    skinIndex: 0,
    usersTop: {},
  };

  function loadData() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) return JSON.parse(saved);
    } catch(e){}
    return {...defaultData};
  }

  function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  let data = loadData();

  const scoreDisplay = document.getElementById('score-display');
  const energyDisplay = document.getElementById('energy-display');
  const coinButton = document.getElementById('coin-button');
  const coinImage = document.getElementById('coin-image');

  const questsTab = document.getElementById('quests-tab');
  const topTab = document.getElementById('top-tab');
  const topList = document.getElementById('top-list');
  const upgradesTab = document.getElementById('upgrades-tab');
  const skinSelector = document.getElementById('skin-selector');
  const donateSection = document.getElementById('donate-section');

  const coinSkins = [
    { name: 'Классическая', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Golden_coin_icon.svg/120px-Golden_coin_icon.svg.png', cost: 0 },
    { name: 'Сияющая', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Gold_coin_icon.svg/120px-Gold_coin_icon.svg.png', cost: 50000 },
    { name: 'Электро', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Bitcoin.svg/120px-Bitcoin.svg.png', cost: 150000 },
    { name: 'Пламя', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Fire_icon.svg/120px-Fire_icon.svg.png', cost: 300000 }
  ];

  function renderSkins() {
    skinSelector.innerHTML = '';
    coinSkins.forEach((skin, idx) => {
      const div = document.createElement('div');
      div.className = 'skin-thumb';
      div.style.backgroundImage = `url(${skin.url})`;
      if (data.skinIndex === idx) div.classList.add('selected');
      div.title = `${skin.name} (Цена: ${skin.cost} монет)`;
      div.onclick = () => {
        if (idx === data.skinIndex) return;
        if (data.score >= skin.cost) {
          data.skinIndex = idx;
          updateScore(-skin.cost);
          saveData();
          updateUI();
          renderSkins();
          alert(`Вы купили и выбрали скин "${skin.name}"`);
        } else {
          alert(`Недостаточно монет для покупки скина "${skin.name}"`);
        }
      };
      skinSelector.appendChild(div);
    });
  }

  const quests = [
    {
      id: 'sub_telegram',
      title: 'Подпишись на наш Telegram канал',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на Telegram канал'),
    },
    {
      id: 'sub_tiktok',
      title: 'Подпишись на TikTok',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на TikTok'),
    },
    {
      id: 'sub_youtube',
      title: 'Подпишись на YouTube',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на YouTube'),
    },
  ];

  function renderQuests() {
    questsTab.innerHTML = '';
    quests.forEach(q => {
      const done = data.questsDone.includes(q.id);
      const div = document.createElement('div');
      div.className = 'quest';

      const h3 = document.createElement('h3');
      h3.textContent = q.title;

      const p = document.createElement('p');
      p.textContent = q.desc;

      const btn = document.createElement('button');
      btn.textContent = done ? 'Выполнено' : 'Выполнить';
      btn.disabled = done;
      btn.className = done ? 'completed' : '';

      btn.onclick = () => {
        if (q.check()) {
          data.questsDone.push(q.id);
          updateScore(q.reward);
          saveData();
          renderQuests();
          updateUI();
          alert(`Вы получили ${q.reward} монет!`);
        }
      };

      div.appendChild(h3);
      div.appendChild(p);
      div.appendChild(btn);

      questsTab.appendChild(div);
    });
  }

  function updateTopList() {
    data.usersTop[user.id] = {
      name: user.first_name || 'Игрок',
      score: data.score,
    };
    saveData();

    const sorted = Object.values(data.usersTop).sort((a, b) => b.score - a.score);

    topList.innerHTML = '';
    sorted.slice(0, 10).forEach((u, idx) => {
      const tr = document.createElement('tr');
      const tdName = document.createElement('td');
      tdName.textContent = u.name;
      const tdScore = document.createElement('td');
      tdScore.textContent = u.score;
      tr.appendChild(tdName);
      tr.appendChild(tdScore);
      topList.appendChild(tr);
    });
  }

  // Апгрейды: теперь всего два товара, с нарастающей ценой и эффектом
  // Цены начинаются дешевле и растут по формуле: baseCost * 1.5^level
  const upgradesList = [
    {
      id: 'click',
      title: 'Улучшить клик',
      desc: 'Увеличивает количество монет за клик',
      baseCost: 500,
      baseAmount: 1,
      getCost() {
        return Math.floor(this.baseCost * Math.pow(1.5, data.upgradesBought.click));
      },
      buy() {
        data.clickPower += this.baseAmount;
        data.upgradesBought.click++;
      },
      getDesc() {
        return `+${this.baseAmount} монет за клик`;
      }
    },
    {
      id: 'energy',
      title: 'Улучшить энергию',
      desc: 'Увеличивает максимум энергии и восстанавливает её',
      baseCost: 700,
      baseAmount: 10,
      getCost() {
        return Math.floor(this.baseCost * Math.pow(1.5, data.upgradesBought.energy));
      },
      buy() {
        data.energyMax += this.baseAmount;
        data.energy += this.baseAmount;
        if(data.energy > data.energyMax) data.energy = data.energyMax;
        data.upgradesBought.energy++;
      },
      getDesc() {
        return `+${this.baseAmount} к максимуму энергии и текущей энергии`;
      }
    }
  ];

  function renderUpgrades() {
    upgradesTab.innerHTML = '';
    upgradesList.forEach(upg => {
      const level = data.upgradesBought[upg.id];
      const cost = upg.getCost();

      const div = document.createElement('div');
      div.className = 'upgrade';

      const info = document.createElement('div');
      info.className = 'upgrade-info';

      const title = document.createElement('h4');
      title.textContent = `${upg.title} (уровень: ${level})`;

      const desc = document.createElement('p');
      desc.textContent = upg.getDesc();

      info.appendChild(title);
      info.appendChild(desc);

      const btn = document.createElement('button');
      btn.textContent = `Купить за ${cost} монет`;
      btn.disabled = data.score < cost;
      btn.onclick = () => {
        if (data.score >= cost) {
          updateScore(-cost);
          upg.buy();
          saveData();
          renderUpgrades();
          updateUI();
        }
      };

      div.appendChild(info);
      div.appendChild(btn);

      upgradesTab.appendChild(div);
    });
  }

  // Обновляем UI - счет, энергия, монета, скин
  function updateUI() {
    scoreDisplay.textContent = `Монеты: ${data.score}`;
    energyDisplay.textContent = `Энергия: ${Math.floor(data.energy)} / ${data.energyMax}`;
    coinImage.src = coinSkins[data.skinIndex].url;
    updateTopList();
  }

  // Обновляем счет и сохраняем
  function updateScore(amount) {
    data.score += amount;
    if (data.score < 0) data.score = 0;
  }

  // Клик по монете
  coinButton.onclick = () => {
    if (data.energy >= 1) {
      data.energy -= 1;
      updateScore(data.clickPower);
      saveData();
      updateUI();
    } else {
      alert('Не хватает энергии! Прокачай энергию в разделе "Прокачка".');
    }
  };

  // Восполнение энергии +1 каждую секунду
  setInterval(() => {
    if (data.energy < data.energyMax) {
      data.energy += 1;
      if (data.energy > data.energyMax) data.energy = data.energyMax;
      saveData();
      updateUI();
    }
  }, 1000);

  // Переключение вкладок
  const tabButtons = document.querySelectorAll('footer button.tab-btn');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const tabId = btn.dataset.tab;
      ['tap-tab', 'quests-tab', 'top-tab', 'upgrades-tab', 'donate-section'].forEach(id => {
        document.getElementById(id).classList.toggle('hidden', id !== tabId);
      });

      if (tabId === 'quests-tab') renderQuests();
      if (tabId === 'upgrades-tab') renderUpgrades();
      if (tabId === 'top-tab') updateTopList();
      if (tabId === 'tap-tab') updateUI();
    });
  });

  // Инициализация
  renderSkins();
  renderQuests();
  renderUpgrades();
  updateUI();
</script>

</body>
</html>
