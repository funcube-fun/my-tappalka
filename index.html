<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ukraine Coin</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
  body {
    margin: 0; 
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #f0f0f0;
    display: flex; 
    flex-direction: column;
    height: 100vh;
  }
  header {
    background: #ffdd00;
    color: #1e3c72;
    padding: 18px 0;
    text-align: center;
    font-size: 2.2rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    user-select: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  main {
    flex: 1;
    padding: 25px 30px 80px; /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –º–µ–Ω—é */
    overflow-y: auto;
    background: #243b55;
    border-radius: 0 0 12px 12px;
    box-shadow: inset 0 0 40px #162447;
  }
  .hidden {
    display: none;
  }
  /* –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫ */
  #coin {
    margin: 50px auto 30px;
    width: 130px;
    height: 130px;
    background: radial-gradient(circle at center, #ffdd00 65%, #b38f00 100%);
    border-radius: 50%;
    box-shadow: 0 0 25px #ffdd00;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 4rem;
    user-select: none;
    transition: transform 0.15s ease-in-out;
  }
  #coin:active {
    transform: scale(0.9);
    box-shadow: 0 0 40px #fff700;
  }
  #score {
    font-size: 2.4rem;
    text-align: center;
    margin-top: 10px;
    letter-spacing: 1px;
    font-weight: 700;
    text-shadow: 0 0 7px #ffdd00;
  }
  ul {
    list-style: none;
    padding-left: 0;
  }
  li {
    background: #1a2a47;
    margin-bottom: 16px;
    padding: 18px 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    font-size: 1.1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #c9d1e8;
  }
  li.completed {
    background: #ffdd00;
    color: #162447;
    font-weight: 700;
    text-decoration: line-through;
    box-shadow: 0 0 15px #ffdd00;
  }
  li a {
    color: #ffdd00;
    font-weight: 700;
    text-decoration: none;
    margin-left: 15px;
    transition: color 0.3s;
  }
  li a:hover {
    color: #fff700;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 18px;
    font-size: 1.1rem;
  }
  th, td {
    padding: 14px 10px;
    border-bottom: 2px solid #162447;
    text-align: left;
  }
  th {
    background: #1a2a47;
    color: #ffdd00;
    letter-spacing: 1px;
  }
  tr:nth-child(even) {
    background: #162447;
  }
  tr.top-player {
    background: #ffdd00;
    color: #162447;
    font-weight: 700;
    box-shadow: 0 0 10px #fff700;
  }

  /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
  footer {
    position: fixed;
    bottom: 0;
    left: 0; right: 0;
    height: 60px;
    background: #162447;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -3px 10px rgba(0,0,0,0.7);
    user-select: none;
    z-index: 1000;
  }
  footer button {
    background: none;
    border: none;
    color: #a9b1d6;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    flex: 1;
    padding: 8px 0;
    transition: color 0.3s, border-top 0.3s;
    border-top: 3px solid transparent;
  }
  footer button.active {
    color: #ffdd00;
    border-top: 3px solid #ffdd00;
    font-weight: 700;
  }
  footer button:hover:not(.active) {
    color: #fff700;
  }

  /* –ü—Ä–æ–∫–∞—á–∫–∞ */
  #page-upgrades ul {
    padding-left: 0;
  }
  #page-upgrades li {
    background: #1a2a47;
    margin-bottom: 16px;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    font-size: 1.2rem;
    color: #c9d1e8;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #page-upgrades li button {
    background: #ffdd00;
    color: #162447;
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #page-upgrades li button:hover {
    background-color: #ffd633;
  }
</style>
</head>
<body>
<header>Ukraine Coin</header>
<main>
  <!-- Tap -->
  <section id="page-tap">
    <div id="coin" title="Tap me!">ü™ô</div>
    <div id="score">Score: 0</div>
  </section>
  <!-- Quests -->
  <section id="page-quests" class="hidden">
    <ul id="quest-list"></ul>
  </section>
  <!-- Top -->
  <section id="page-top" class="hidden">
    <table>
      <thead>
        <tr><th>Player</th><th>Score</th></tr>
      </thead>
      <tbody id="top-list"></tbody>
    </table>
  </section>
  <!-- Upgrades -->
  <section id="page-upgrades" class="hidden">
    <ul id="upgrade-list">
      <!-- –ü—Ä–æ–∫–∞—á–∫–∏ –±—É–¥—É—Ç —Ç—É—Ç -->
    </ul>
  </section>
</main>
<footer>
  <button id="tab-tap" class="active">Tap</button>
  <button id="tab-quests">Quests</button>
  <button id="tab-top">Top</button>
  <button id="tab-upgrades">–ü—Ä–æ–∫–∞—á–∫–∞</button>
</footer>

<script>
  const WebApp = window.Telegram.WebApp;
  WebApp.ready();

  const user = WebApp.initDataUnsafe.user || { id: 'guest', first_name: 'Guest' };
  const playerId = user.id || 'guest';
  const playerName = user.first_name || 'Guest';

  const STORAGE_TOP_KEY = 'ukraine_coin_top';
  const STORAGE_SCORE_KEY = 'score_' + playerId;
  const STORAGE_UPGRADES_KEY = 'upgrades_' + playerId;

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø–∞
  function loadTop() {
    const data = localStorage.getItem(STORAGE_TOP_KEY);
    return data ? JSON.parse(data) : [];
  }
  function saveTop(top) {
    localStorage.setItem(STORAGE_TOP_KEY, JSON.stringify(top));
  }
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–∞
  function updateTop(playerName, score) {
    let top = loadTop();
    const idx = top.findIndex(p => p.name === playerName);
    if (idx !== -1) {
      if(score > top[idx].score) top[idx].score = score;
    } else {
      top.push({ name: playerName, score });
    }
    top.sort((a,b) => b.score - a.score);
    if(top.length > 10) top.length = 10;
    saveTop(top);
    return top;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∫–∞—á–µ–∫
  function loadUpgrades() {
    const data = localStorage.getItem(STORAGE_UPGRADES_KEY);
    return data ? JSON.parse(data) : {
      clickPower: 1, // —Å–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç –∑–∞ –∫–ª–∏–∫
      autoClicker: 0 // –∞–≤—Ç–æ–Ω–∞–∫–ª–∏–∫–∏ (–±—É–¥–µ—Ç –≤ –±—É–¥—É—â–µ–º)
    };
  }
  function saveUpgrades(upgrades) {
    localStorage.setItem(STORAGE_UPGRADES_KEY, JSON.stringify(upgrades));
  }

  // –°—á—ë—Ç
  let score = parseInt(localStorage.getItem(STORAGE_SCORE_KEY)) || 0;

  // –ü—Ä–æ–∫–∞—á–∫–∏
  let upgrades = loadUpgrades();

  // –ö–≤–µ—Å—Ç—ã
  const quests = [
    { id: 1, text: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ Telegram –∫–∞–Ω–∞–ª', link: 'https://t.me/your_channel', reward: 10000 },
    { id: 2, text: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ TikTok', link: 'https://www.tiktok.com/@your_tiktok', reward: 10000 },
    { id: 3, text: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ YouTube', link: 'https://www.youtube.com/channel/your_youtube', reward: 10000 },
    { id: 4, text: '–ù–∞–∫–ª–∏–∫–∞–π 1,000 —Ä–∞–∑', target: 1000, reward: 1000 },
    { id: 5, text: '–ù–∞–∫–ª–∏–∫–∞–π 10,000 —Ä–∞–∑', target: 10000, reward: 10000 },
    { id: 6, text: '–ù–∞–∫–ª–∏–∫–∞–π 100,000 —Ä–∞–∑', target: 100000, reward: 20000 },
    { id: 7, text: '–ù–∞–∫–ª–∏–∫–∞–π 200,000 —Ä–∞–∑', target: 200000, reward: 30000 },
  ];

  // –ü—Ä–æ–∫–∞—á–∫–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
  const upgradesList = [
    { id: 'clickPower', name: '–£–≤–µ–ª–∏—á–∏—Ç—å –º–æ–Ω–µ—Ç—ã –∑–∞ –∫–ª–∏–∫ (+1)', baseCost: 5000, costMult: 2 },
  ];

  // DOM
  const scoreDisplay = document.getElementById('score');
  const coin = document.getElementById('coin');
  const questList = document.getElementById('quest-list');
  const topList = document.getElementById('top-list');
  const upgradeList = document.getElementById('upgrade-list');

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è
  const tabs = ['tap', 'quests', 'top', 'upgrades'];
  function showTab(tab) {
    tabs.forEach(t => {
      document.getElementById('tab-' + t).classList.remove('active');
      document.getElementById('page-' + t).classList.add('hidden');
    });
    document.getElementById('tab-' + tab).classList.add('active');
    document.getElementById('page-' + tab).classList.remove('hidden');
  }
  tabs.forEach(tab => {
    document.getElementById('tab-' + tab).addEventListener('click', () => {
      showTab(tab);
    });
  });

  // –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç
  function updateScore() {
    scoreDisplay.textContent = `Score: ${score.toLocaleString()}`;
  }
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—á—ë—Ç
  function saveScore() {
    localStorage.setItem(STORAGE_SCORE_KEY, score);
  }
  // –û–±–Ω–æ–≤–∏—Ç—å –∫–≤–µ—Å—Ç—ã
  function updateQuests() {
    questList.innerHTML = '';
    quests.forEach(q => {
      let completed = false;
      if(q.target) {
        completed = score >= q.target;
      } else if(q.reward && q.link) {
        completed = localStorage.getItem(`quest_done_${q.id}_${playerId}`) === 'true';
      }
      const li = document.createElement('li');
      li.className = completed ? 'completed' : '';
      li.innerHTML = `
        <span>${q.text}</span>
        ${
          q.link ? 
          (completed ? '‚úÖ' : `<a href="${q.link}" target="_blank" rel="noopener noreferrer">–ü–µ—Ä–µ–π—Ç–∏</a>`) 
          : completed ? '‚úÖ' : ''
        }
      `;
      if(q.link && !completed) {
        li.querySelector('a').addEventListener('click', () => {
          alert(`–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É! –¢—ã –ø–æ–ª—É—á–∏–ª ${q.reward.toLocaleString()} –º–æ–Ω–µ—Ç.`);
          score += q.reward;
          saveScore();
          updateScore();
          localStorage.setItem(`quest_done_${q.id}_${playerId}`, 'true');
          updateQuests();
          updateTopList();
          updateTop(playerName, score);
        });
      }
      questList.appendChild(li);
    });
  }
  // –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ø
  function updateTopList() {
    const top = updateTop(playerName, score);
    topList.innerHTML = '';
    top.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.className = p.name === playerName ? 'top-player' : '';
      tr.innerHTML = `<td>${i+1}. ${p.name}</td><td>${p.score.toLocaleString()}</td>`;
      topList.appendChild(tr);
    });
  }
  // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–∫–∞—á–∫–∏
  function updateUpgrades() {
    upgradeList.innerHTML = '';
    upgradesList.forEach(upg => {
      const level = upgrades[upg.id] || 0;
      const cost = Math.floor(upg.baseCost * Math.pow(upg.costMult, level));
      const li = document.createElement('li');
      li.innerHTML = `
        <span>${upg.name} (—É—Ä–æ–≤–µ–Ω—å: ${level})</span>
        <button ${score < cost ? 'disabled' : ''}>–ö—É–ø–∏—Ç—å –∑–∞ ${cost.toLocaleString()}</button>
      `;
      li.querySelector('button').addEventListener('click', () => {
        if(score >= cost) {
          score -= cost;
          upgrades[upg.id] = level + 1;
          saveScore();
          saveUpgrades(upgrades);
          updateScore();
          updateUpgrades();
          updateTop(playerName, score);
          updateTopList();
        }
      });
      upgradeList.appendChild(li);
    });
  }

  // –ö–ª–∏–∫ –ø–æ –º–æ–Ω–µ—Ç–µ
  coin.addEventListener('click', () => {
    score += upgrades.clickPower || 1;
    saveScore();
    updateScore();
    WebApp.HapticFeedback.impactOccurred('medium');
    updateQuests();
    updateTopList();
    WebApp.sendData(JSON.stringify({ score }));
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  updateScore();
  updateQuests();
  updateTopList();
  updateUpgrades();

  // –ü–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Ç–µ–º—É —Ç–µ–ª–µ–≥—Ä–∞–º (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
  WebApp.onEvent('themeChanged', () => {
    // –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç–∞ —Ç—É—Ç
  });

  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "—Ç–∞–ø"
  showTab('tap');
</script>
</body>
</html>
