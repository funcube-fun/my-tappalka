<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ukraine Coin</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
  body {
    margin: 0; 
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #f0f0f0;
    display: flex; 
    flex-direction: column;
    height: 100vh;
  }
  header {
    background: #ffdd00;
    color: #1e3c72;
    padding: 18px 0;
    text-align: center;
    font-size: 2.2rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    user-select: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  nav {
    display: flex;
    background: #162447;
    justify-content: space-around;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  }
  nav button {
    flex: 1;
    padding: 15px;
    font-size: 1.1rem;
    color: #a9b1d6;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: background 0.3s, color 0.3s;
    font-weight: 600;
  }
  nav button.active, nav button:hover {
    background: #ffdd00;
    color: #162447;
    font-weight: 700;
    box-shadow: 0 0 12px #ffdd00;
    border-radius: 8px 8px 0 0;
  }
  main {
    flex: 1;
    padding: 25px 30px 30px;
    overflow-y: auto;
    background: #243b55;
    border-radius: 0 0 12px 12px;
    box-shadow: inset 0 0 40px #162447;
  }
  .hidden {
    display: none;
  }
  /* Tap page */
  #coin {
    margin: 50px auto 30px;
    width: 130px;
    height: 130px;
    background: radial-gradient(circle at center, #ffdd00 65%, #b38f00 100%);
    border-radius: 50%;
    box-shadow: 0 0 25px #ffdd00;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 4rem;
    user-select: none;
    transition: transform 0.15s ease-in-out;
  }
  #coin:active {
    transform: scale(0.9);
    box-shadow: 0 0 40px #fff700;
  }
  #score {
    font-size: 2.4rem;
    text-align: center;
    margin-top: 10px;
    letter-spacing: 1px;
    font-weight: 700;
    text-shadow: 0 0 7px #ffdd00;
  }
  /* Quests */
  ul {
    list-style: none;
    padding-left: 0;
  }
  li {
    background: #1a2a47;
    margin-bottom: 16px;
    padding: 18px 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    font-size: 1.1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #c9d1e8;
  }
  li.completed {
    background: #ffdd00;
    color: #162447;
    font-weight: 700;
    text-decoration: line-through;
    box-shadow: 0 0 15px #ffdd00;
  }
  li a {
    color: #ffdd00;
    font-weight: 700;
    text-decoration: none;
    margin-left: 15px;
    transition: color 0.3s;
  }
  li a:hover {
    color: #fff700;
  }
  /* Top */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 18px;
    font-size: 1.1rem;
  }
  th, td {
    padding: 14px 10px;
    border-bottom: 2px solid #162447;
    text-align: left;
  }
  th {
    background: #1a2a47;
    color: #ffdd00;
    letter-spacing: 1px;
  }
  tr:nth-child(even) {
    background: #162447;
  }
  tr.top-player {
    background: #ffdd00;
    color: #162447;
    font-weight: 700;
    box-shadow: 0 0 10px #fff700;
  }
</style>
</head>
<body>
<header>Ukraine Coin</header>
<nav>
  <button id="tab-tap" class="active">Tap</button>
  <button id="tab-quests">Quests</button>
  <button id="tab-top">Top</button>
</nav>
<main>
  <!-- Tap page -->
  <section id="page-tap">
    <div id="coin" title="Tap me!">ü™ô</div>
    <div id="score">Score: 0</div>
  </section>
  <!-- Quests page -->
  <section id="page-quests" class="hidden">
    <ul id="quest-list"></ul>
  </section>
  <!-- Top page -->
  <section id="page-top" class="hidden">
    <table>
      <thead>
        <tr><th>Player</th><th>Score</th></tr>
      </thead>
      <tbody id="top-list"></tbody>
    </table>
  </section>
</main>

<script>
  const WebApp = window.Telegram.WebApp;
  WebApp.ready();

  const user = WebApp.initDataUnsafe.user || { id: 'guest', first_name: 'Guest' };
  const playerId = user.id || 'guest';
  const playerName = user.first_name || 'Guest';

  // –ü–æ–¥–≥—Ä—É–∂–∞–µ–º –æ–±—â–∏–π —Ç–æ–ø –∏–∑ localStorage –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π
  const STORAGE_TOP_KEY = 'ukraine_coin_top';

  function loadTop() {
    const data = localStorage.getItem(STORAGE_TOP_KEY);
    return data ? JSON.parse(data) : [];
  }
  function saveTop(top) {
    localStorage.setItem(STORAGE_TOP_KEY, JSON.stringify(top));
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –≤ —Ç–æ–ø
  function updateTop(playerName, score) {
    let top = loadTop();
    const idx = top.findIndex(p => p.name === playerName);
    if (idx !== -1) {
      if(score > top[idx].score) top[idx].score = score;
    } else {
      top.push({ name: playerName, score });
    }
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –æ—á–∫–æ–≤ –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ø 10
    top.sort((a,b) => b.score - a.score);
    if(top.length > 10) top.length = 10;
    saveTop(top);
    return top;
  }

  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  let score = parseInt(localStorage.getItem('score_' + playerId)) || 0;

  const quests = [
    { id: 1, text: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ Telegram –∫–∞–Ω–∞–ª', link: 'https://t.me/your_channel', reward: 10000 },
    { id: 2, text: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ TikTok', link: 'https://www.tiktok.com/@your_tiktok', reward: 10000 },
    { id: 3, text: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ YouTube', link: 'https://www.youtube.com/channel/your_youtube', reward: 10000 },
    { id: 4, text: '–ù–∞–∫–ª–∏–∫–∞–π 1,000 —Ä–∞–∑', target: 1000, reward: 1000 },
    { id: 5, text: '–ù–∞–∫–ª–∏–∫–∞–π 10,000 —Ä–∞–∑', target: 10000, reward: 10000 },
    { id: 6, text: '–ù–∞–∫–ª–∏–∫–∞–π 100,000 —Ä–∞–∑', target: 100000, reward: 20000 },
    { id: 7, text: '–ù–∞–∫–ª–∏–∫–∞–π 200,000 —Ä–∞–∑', target: 200000, reward: 30000 },
  ];

  // DOM
  const scoreDisplay = document.getElementById('score');
  const coin = document.getElementById('coin');
  const questList = document.getElementById('quest-list');
  const topList = document.getElementById('top-list');

  // –§—É–Ω–∫—Ü–∏–∏
  function updateScore() {
    scoreDisplay.textContent = `Score: ${score.toLocaleString()}`;
  }

  function saveScore() {
    localStorage.setItem('score_' + playerId, score);
  }

  function updateQuests() {
    questList.innerHTML = '';
    quests.forEach(q => {
      let completed = false;
      if(q.target) {
        completed = score >= q.target;
      } else if(q.reward && q.link) {
        // –î–ª—è –ø–æ–¥–ø–∏—Å–æ–∫ ‚Äî —Å—Ç–∞–≤–∏–º completed –µ—Å–ª–∏ —É–∂–µ –ø–æ–ª—É—á–∏–ª –Ω–∞–≥—Ä–∞–¥—É (–≤ localStorage)
        completed = localStorage.getItem(`quest_done_${q.id}_${playerId}`) === 'true';
      }
      const li = document.createElement('li');
      li.className = completed ? 'completed' : '';
      li.innerHTML = `
        <span>${q.text}</span>
        ${
          q.link ? 
          (completed ? '‚úÖ' : `<a href="${q.link}" target="_blank" rel="noopener noreferrer">–ü–µ—Ä–µ–π—Ç–∏</a>`) 
          : completed ? '‚úÖ' : ''
        }
      `;
      // –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äî –¥–∞—ë–º –Ω–∞–≥—Ä–∞–¥—É –∏ —Å—Ç–∞–≤–∏–º completed
      if(q.link && !completed) {
        li.querySelector('a').addEventListener('click', () => {
          alert(`–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É! –¢—ã –ø–æ–ª—É—á–∏–ª ${q.reward.toLocaleString()} –º–æ–Ω–µ—Ç.`);
          score += q.reward;
          saveScore();
          updateScore();
          localStorage.setItem(`quest_done_${q.id}_${playerId}`, 'true');
          updateQuests();
          updateTopList();
          updateTop(playerName, score);
        });
      }
      questList.appendChild(li);
    });
  }

  function updateTopList() {
    const top = updateTop(playerName, score);
    topList.innerHTML = '';
    top.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.className = p.name === playerName ? 'top-player' : '';
      tr.innerHTML = `<td>${i+1}. ${p.name}</td><td>${p.score.toLocaleString()}</td>`;
      topList.appendChild(tr);
    });
  }

  coin.addEventListener('click', () => {
    score++;
    saveScore();
    updateScore();
    WebApp.HapticFeedback.impactOccurred('medium');
    updateQuests();
    updateTopList();
    WebApp.sendData(JSON.stringify({ score }));
  });

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
  const tabs = ['tap', 'quests', 'top'];
  tabs.forEach(tab => {
    document.getElementById('tab-' + tab).addEventListener('click', () => {
      tabs.forEach(t => {
        document.getElementById('tab-' + t).classList.remove('active');
        document.getElementById('page-' + t).classList.add('hidden');
      });
      document.getElementById('tab-' + tab).classList.add('active');
      document.getElementById('page-' + tab).classList.remove('hidden');
    });
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  updateScore();
  updateQuests();
  updateTopList();

  WebApp.onEvent('themeChanged', () => {
    // –ü–æ–¥—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤ –ø–æ–¥ —Ç–µ–º—É (–ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏)
  });
</script>
</body>
</html>
