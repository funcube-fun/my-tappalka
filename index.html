<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ukraine Coin - Tapalka</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

  body {
    margin: 0;
    font-family: 'Montserrat', sans-serif;
    background: #000;
    color: #fff;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    text-align: center;
    padding: 15px 10px 10px;
    font-weight: 700;
    font-size: 24px;
    letter-spacing: 1.2px;
    user-select: none;
    color: #ffdd33;
    text-shadow: 0 0 10px #ffdd33;
  }
  main {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px 15px;
  }
  footer {
    display: flex;
    justify-content: space-around;
    background: #111;
    padding: 8px 0;
    user-select: none;
    border-top: 1px solid #333;
  }
  footer button {
    background: none;
    border: none;
    color: #aaa;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 8px;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  footer button.active, footer button:hover {
    background-color: #ffdd33;
    color: #000;
  }
  .hidden {
    display: none;
  }
  /* --- TAP TAB --- */
  #tap-tab {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #coin-button {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    border: 5px solid #ffdd33;
    background: radial-gradient(circle at center, #ffd833 40%, #b28800 90%);
    box-shadow: 0 0 25px #ffdd33;
    cursor: pointer;
    margin: 25px 0;
    position: relative;
    transition: transform 0.1s ease;
    user-select: none;
  }
  #coin-button:active {
    transform: scale(0.9);
  }
  #coin-button img {
    width: 90px;
    position: absolute;
    top: 25px;
    left: 50%;
    transform: translateX(-50%);
    user-select: none;
    pointer-events: none;
  }
  #score-display {
    font-size: 36px;
    font-weight: 700;
    text-shadow: 0 0 15px #ffdd33;
  }
  #energy-display {
    font-size: 18px;
    margin-top: 10px;
    color: #ffcc00;
    text-shadow: 0 0 6px #ffcc00;
  }
  /* --- QUESTS TAB --- */
  #quests-tab {
    max-width: 600px;
    margin: 0 auto;
  }
  .quest {
    background: rgba(255, 221, 51, 0.1);
    border-radius: 12px;
    margin-bottom: 15px;
    padding: 15px 20px;
    box-shadow: 0 0 12px #b28800;
  }
  .quest h3 {
    margin: 0 0 8px 0;
    font-weight: 700;
    color: #fff;
  }
  .quest p {
    margin: 6px 0 12px 0;
    font-size: 14px;
    color: #ffdd33cc;
  }
  .quest button {
    background: #ffdd33;
    border: none;
    color: #000;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .quest button.completed {
    background: #33cc33;
    cursor: default;
    color: #000;
  }
  .quest button:disabled {
    opacity: 0.7;
    cursor: default;
  }
  /* --- TOP TAB --- */
  #top-tab {
    max-width: 600px;
    margin: 0 auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    color: #ffdd33cc;
    font-weight: 600;
  }
  th, td {
    padding: 10px 8px;
    border-bottom: 1px solid #333;
    text-align: left;
  }
  th {
    background: #b28800;
    color: #000;
  }
  /* --- UPGRADES TAB --- */
  #upgrades-tab {
    max-width: 600px;
    margin: 0 auto;
  }
  .upgrade {
    background: rgba(255, 221, 51, 0.1);
    border-radius: 12px;
    margin-bottom: 15px;
    padding: 15px 20px;
    box-shadow: 0 0 12px #b28800;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .upgrade-info {
    max-width: 70%;
  }
  .upgrade-info h4 {
    margin: 0 0 8px 0;
    font-weight: 700;
    color: #fff;
  }
  .upgrade-info p {
    margin: 0;
    font-size: 14px;
    color: #ffdd33cc;
  }
  .upgrade button {
    background: #ffdd33;
    border: none;
    color: #000;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .upgrade button:disabled {
    opacity: 0.6;
    cursor: default;
  }
  /* --- DONATE BUTTON --- */
  #donate-section {
    text-align: center;
    margin-top: 20px;
  }
  #donate-section a {
    display: inline-block;
    background: #00cc44;
    color: white;
    font-weight: 700;
    padding: 14px 30px;
    border-radius: 30px;
    text-decoration: none;
    font-size: 18px;
    box-shadow: 0 0 15px #00cc44;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #donate-section a:hover {
    background: #009933;
  }
  /* --- SKINS --- */
  #skin-selector {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .skin-thumb {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 3px solid transparent;
    cursor: pointer;
    transition: border-color 0.3s ease;
    box-shadow: 0 0 8px #b28800;
    background-size: cover;
    background-position: center;
  }
  .skin-thumb.selected {
    border-color: #ffdd33;
    box-shadow: 0 0 15px #ffdd33;
  }
</style>
</head>
<body>
<header>Ukraine Coin</header>

<main>
  <!-- TAP TAB -->
  <section id="tap-tab">
    <div id="score-display">Монеты: 0</div>
    <button id="coin-button" title="Нажми на монету!">
      <img id="coin-image" src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Golden_coin_icon.svg/120px-Golden_coin_icon.svg.png" alt="Монета" />
    </button>
    <div id="energy-display">Энергия: 100 / 100</div>
    <div id="skin-selector" title="Выбери скин монеты"></div>
  </section>

  <!-- QUESTS TAB -->
  <section id="quests-tab" class="hidden"></section>

  <!-- TOP TAB -->
  <section id="top-tab" class="hidden">
    <table>
      <thead>
        <tr><th>Игрок</th><th>Монеты</th></tr>
      </thead>
      <tbody id="top-list"></tbody>
    </table>
  </section>

  <!-- UPGRADES TAB -->
  <section id="upgrades-tab" class="hidden"></section>

  <section id="donate-section" class="hidden">
    <a href="https://savelife.in.ua/donate/" target="_blank" rel="noopener noreferrer" title="Помочь ЗСУ">Поддержать ЗСУ</a>
  </section>
</main>

<footer>
  <button class="tab-btn active" data-tab="tap-tab">Тап</button>
  <button class="tab-btn" data-tab="quests-tab">Задания</button>
  <button class="tab-btn" data-tab="top-tab">Топ</button>
  <button class="tab-btn" data-tab="upgrades-tab">Прокачка</button>
  <button class="tab-btn" data-tab="donate-section">Донат</button>
</footer>

<script>
  // --- ДАННЫЕ ---
  const WebApp = window.Telegram?.WebApp || null;
  if (WebApp) WebApp.ready();

  // Юзер (пока просто фиктивный, можно заменить на WebApp.initDataUnsafe.user)
  let user = WebApp?.initDataUnsafe?.user || { id: 'user' + Math.floor(Math.random() * 10000), first_name: 'Игрок' };

  // -----------------------
  // Хранилище
  // -----------------------
  const STORAGE_KEY = 'ukraine_coin_data';

  // Начальные данные
  const defaultData = {
    score: 0,
    energy: 100,
    energyMax: 100,
    clickPower: 1,
    upgrades: [],
    questsDone: [],
    skinIndex: 0,
    usersTop: {},
  };

  // Загрузка из localStorage
  function loadData() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        return JSON.parse(saved);
      }
    } catch(e) {}
    return {...defaultData};
  }

  // Сохранение
  function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  // -----------------------
  // Данные
  // -----------------------
  let data = loadData();

  // -----------------------
  // UI Элементы
  // -----------------------
  const scoreDisplay = document.getElementById('score-display');
  const energyDisplay = document.getElementById('energy-display');
  const coinButton = document.getElementById('coin-button');
  const coinImage = document.getElementById('coin-image');

  const questsTab = document.getElementById('quests-tab');
  const topTab = document.getElementById('top-tab');
  const topList = document.getElementById('top-list');
  const upgradesTab = document.getElementById('upgrades-tab');
  const skinSelector = document.getElementById('skin-selector');
  const donateSection = document.getElementById('donate-section');

  // -----------------------
  // Скины монеток
  // -----------------------
  const coinSkins = [
    { name: 'Классическая', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Golden_coin_icon.svg/120px-Golden_coin_icon.svg.png', cost: 0 },
    { name: 'Сияющая', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Gold_coin_icon.svg/120px-Gold_coin_icon.svg.png', cost: 50000 },
    { name: 'Электро', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Bitcoin.svg/120px-Bitcoin.svg.png', cost: 150000 },
    { name: 'Пламя', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Fire_icon.svg/120px-Fire_icon.svg.png', cost: 300000 }
  ];

  // Рендер выбора скинов
  function renderSkins() {
    skinSelector.innerHTML = '';
    coinSkins.forEach((skin, idx) => {
      const div = document.createElement('div');
      div.className = 'skin-thumb';
      div.style.backgroundImage = `url(${skin.url})`;
      if (data.skinIndex === idx) div.classList.add('selected');

      div.title = `${skin.name} (Цена: ${skin.cost} монет)`;
      div.onclick = () => {
        if (idx === data.skinIndex) return; // уже выбран

        if (data.score >= skin.cost) {
          data.skinIndex = idx;
          updateScore(-skin.cost);
          saveData();
          updateUI();
          renderSkins();
          alert(`Вы купили и выбрали скин "${skin.name}"`);
        } else {
          alert(`Недостаточно монет для покупки скина "${skin.name}"`);
        }
      };
      skinSelector.appendChild(div);
    });
  }

  // -----------------------
  // Задания
  // -----------------------
  const quests = [
    {
      id: 'sub_telegram',
      title: 'Подпишись на наш Telegram канал',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на Telegram канал'),
    },
    {
      id: 'sub_tiktok',
      title: 'Подпишись на TikTok',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на TikTok'),
    },
    {
      id: 'sub_youtube',
      title: 'Подпишись на YouTube',
      desc: 'Получите +10000 монет за подписку',
      reward: 10000,
      check: () => confirm('Подтвердите, что подписались на YouTube'),
    },
  ];

  // Рендер заданий
  function renderQuests() {
    questsTab.innerHTML = '';
    quests.forEach(q => {
      const done = data.questsDone.includes(q.id);
      const div = document.createElement('div');
      div.className = 'quest';

      const h3 = document.createElement('h3');
      h3.textContent = q.title;

      const p = document.createElement('p');
      p.textContent = q.desc;

      const btn = document.createElement('button');
      btn.textContent = done ? 'Выполнено' : 'Выполнить';
      btn.disabled = done;
      btn.className = done ? 'completed' : '';

      btn.onclick = () => {
        if (q.check()) {
          data.questsDone.push(q.id);
          updateScore(q.reward);
          saveData();
          renderQuests();
          updateUI();
          alert(`Вы получили ${q.reward} монет!`);
        }
      };

      div.appendChild(h3);
      div.appendChild(p);
      div.appendChild(btn);

      questsTab.appendChild(div);
    });
  }

  // -----------------------
  // Топ игроков (локальный)
  // -----------------------
  function updateTopList() {
    // Запишем текущего пользователя в топ
    data.usersTop[user.id] = {
      name: user.first_name || 'Игрок',
      score: data.score,
    };
    // Сохраним
    saveData();

    // Отсортируем по убыванию
    const sorted = Object.values(data.usersTop).sort((a, b) => b.score - a.score);

    // Очистим таблицу
    topList.innerHTML = '';

    sorted.slice(0, 10).forEach((u, idx) => {
      const tr = document.createElement('tr');
      const tdName = document.createElement('td');
      tdName.textContent = u.name;

      const tdScore = document.createElement('td');
      tdScore.textContent = u.score;

      tr.appendChild(tdName);
      tr.appendChild(tdScore);
      topList.appendChild(tr);
    });
  }

  // -----------------------
  // Улучшения (прокачка)
  // -----------------------
  let upgradesList = [
    {
      id: 'clickPower_10',
      title: '+10 монет за клик',
      desc: 'Увеличивает количество монет за клик на 10',
      cost: 1000,
      effect: () => { data.clickPower += 10; }
    },
    {
      id: 'clickPower_50',
      title: '+50 монет за клик',
      desc: 'Увеличивает количество монет за клик на 50',
      cost: 10000,
      effect: () => { data.clickPower += 50; }
    },
    {
      id: 'clickPower_100',
      title: '+100 монет за клик',
      desc: 'Увеличивает количество монет за клик на 100',
      cost: 30000,
      effect: () => { data.clickPower += 100; }
    },
    {
      id: 'energyMax_20',
      title: '+20 к максимуму энергии',
      desc: 'Увеличивает максимум энергии на 20',
      cost: 10000,
      effect: () => { data.energyMax += 20; data.energy += 20; }
    },
    {
      id: 'energyMax_50',
      title: '+50 к максимуму энергии',
      desc: 'Увеличивает максимум энергии на 50',
      cost: 30000,
      effect: () => { data.energyMax += 50; data.energy += 50; }
    }
  ];

  // Рендер апгрейдов
  function renderUpgrades() {
    upgradesTab.innerHTML = '';
    upgradesList.forEach(upg => {
      // Уже куплен? Для простоты - можно купить бесконечно, но можно добавить проверку
      const div = document.createElement('div');
      div.className = 'upgrade';

      const info = document.createElement('div');
      info.className = 'upgrade-info';

      const title = document.createElement('h4');
      title.textContent = upg.title;

      const desc = document.createElement('p');
      desc.textContent = upg.desc;

      info.appendChild(title);
      info.appendChild(desc);

      const btn = document.createElement('button');
      btn.textContent = `Купить (${upg.cost} монет)`;
      btn.disabled = data.score < upg.cost;

      btn.onclick = () => {
        if (data.score >= upg.cost) {
          updateScore(-upg.cost);
          upg.effect();
          saveData();
          renderUpgrades();
          updateUI();
          alert('Улучшение куплено!');
        }
      };

      div.appendChild(info);
      div.appendChild(btn);

      upgradesTab.appendChild(div);
    });
  }

  // -----------------------
  // Обновление счета и энергии
  // -----------------------
  function updateScore(amount) {
    data.score += amount;
    if(data.score < 0) data.score = 0;
  }
  function updateEnergy(amount) {
    data.energy += amount;
    if(data.energy > data.energyMax) data.energy = data.energyMax;
    if(data.energy < 0) data.energy = 0;
  }

  // -----------------------
  // Обновление UI
  // -----------------------
  function updateUI() {
    scoreDisplay.textContent = `Монеты: ${data.score}`;
    energyDisplay.textContent = `Энергия: ${data.energy} / ${data.energyMax}`;
    coinImage.src = coinSkins[data.skinIndex].url;

    renderSkins();
    renderQuests();
    renderUpgrades();
    updateTopList();

    // Обновить кнопки на апгрейдах (для блокировки)
    Array.from(document.querySelectorAll('#upgrades-tab button')).forEach(btn => {
      const cost = parseInt(btn.textContent.match(/\d+/));
      btn.disabled = data.score < cost;
    });
  }

  // -----------------------
  // Логика клика по монете
  // -----------------------
  coinButton.onclick = () => {
    if(data.energy < 1) {
      alert('Недостаточно энергии! Прокачайте энергию или подождите восстановления.');
      return;
    }
    updateScore(data.clickPower);
    updateEnergy(-1);
    saveData();
    updateUI();

    if (WebApp?.HapticFeedback) {
      WebApp.HapticFeedback.impactOccurred('medium');
    }
  };

  // -----------------------
  // Вкладки
  // -----------------------
  const tabButtons = document.querySelectorAll('footer .tab-btn');
  const sections = ['tap-tab', 'quests-tab', 'top-tab', 'upgrades-tab', 'donate-section'];
  tabButtons.forEach(btn => {
    btn.onclick = () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      sections.forEach(id => {
        const el = document.getElementById(id);
        if(el) {
          if(id === btn.dataset.tab) el.classList.remove('hidden');
          else el.classList.add('hidden');
        }
      });
    };
  });

  // -----------------------
  // Авто-регенерация энергии (например, 1 ед. в 10 секунд)
  // -----------------------
  setInterval(() => {
    if(data.energy < data.energyMax) {
      updateEnergy(1);
      saveData();
      updateUI();
    }
  }, 10000);

  // Стартовое обновление UI
  updateUI();
</script>
</body>
</html>
